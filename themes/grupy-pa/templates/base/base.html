<!doctype html>
<html lang="{% block html_lang %}{{ DEFAULT_LANG }}{% endblock html_lang %}" data-bs-theme="auto">
  {% include "base/head.html" %}

  <body>
    {% include "base/header.html" %}
    <main class="site-main py-5">
      <div class="container">
        {% block content %} {% endblock %}
      </div>
    </main>
    <script>
      const getPreferredTheme = () => {
        if (localStorage.getItem('theme')) {
          return localStorage.getItem('theme');
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      const setTheme = (theme) => {
        document.documentElement.setAttribute('data-bs-theme', theme);
        const icon = document.getElementById('theme-icon');
        if(icon) {
          if (theme === 'dark') {
            icon.classList.remove('bi-moon-stars-fill');
            icon.classList.add('bi-sun-fill');
          } else {
            icon.classList.remove('bi-sun-fill');
            icon.classList.add('bi-moon-stars-fill');
          }
        }
      }

      setTheme(getPreferredTheme());

      window.addEventListener('DOMContentLoaded', () => {
        // Ensure initial render matches state
        setTheme(getPreferredTheme());
        
        const toggleBtn = document.getElementById('theme-toggle');
        if (toggleBtn) {
          toggleBtn.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', newTheme);
            setTheme(newTheme);
          });
        }
      });
    </script>
    {% include "base/footer.html" %}
  </body>

</html>
